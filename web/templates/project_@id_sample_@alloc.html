{% extends "root.html" %}
{% from "_macros.html" import breadcrumbs, icon %}
{% block title %}Allocated Sample Details{% endblock %}
{% block content %}
{{ breadcrumbs([
{"name": "Home", "link": ("/" | app_url) },
{"name": "Projects", "link": ("/project/list" | app_url) },
{"name": allocation.project.id | idfmt("C"), "link": ("/project/" ~ allocation.project.id) | app_url },
{"name": allocation.sample.id | idfmt("S"), "active": true },
]) }}

<h4>Notes <a class="ms-2" href="{{ ("/project/" ~ allocation.project.id ~ "/sample/" ~ allocation.id ~ "/note/new") | app_url }}">{{ icon("plus-square") }}</a></h4>
{% for note in allocation.notes %}
<div class="d-flex column-gap-3 allocation-note-row">
    <div class="">
        <span class="badge {{ note.kind | lower }}">{{ note.kind }}</span>
    </div>
    <div class="flex-shrink-0">
        {{ note.summary }}
    </div>
    <div class="flex-shrink-0">
        {{ icon("calendar") }}
        {{ note.date | dateformat(format="short") }}
    </div>
    <div class="dropdown flex-shrink-1 ms-auto">
        <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown">{{ icon("three-dots-vertical") }}</button>
        <ul class="dropdown-menu dropdown-menu-end">
            <li><a href="{{ ("/project/" ~ allocation.project.id ~ "/sample/" ~ allocation.id ~ "/note/" ~ note.id ~ "/edit") | app_url }}"
                   class="dropdown-item">{{ icon("pencil") }} Edit</a>
            </li>
            <li><button type="button"
                    class="dropdown-item btn-danger"
                    hx-delete="{{ ("/project/" ~ allocation.project.id ~ "/sample/" ~ allocation.id ~ "/note/" ~ note.id) | app_url }}"
                    hx-target="closest .allocation-note-row"
                    hx-swap="outerHTML"
                    hx-confirm="Are you sure you want to remove this note?">{{ icon("x") }} Remove note</button>
            </li>
        </ul>
    </div>
</div>
<div class="text-body-tertiary">
    {{ note.details or "" }}
</div>
{% endfor %}
{% endblock %}
